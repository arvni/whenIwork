import{a as e,r as f,j as d,F as T,u as B,b as me,H as Ce,d as ge}from"./app-f429c5d1.js";import{a as ve,c as C}from"./helper-9f361b88.js";import{T as ye}from"./TableLayout-4cb80c1a.js";import{T as A}from"./TextField-980a54da.js";import{P as be}from"./Popover-e6fdd7be.js";import xe from"./Filter-44ff4c5a.js";import _e from"./ClientRequest-3be42758.js";import Se from"./ConfirmForm-37bccbd3.js";import Re from"./RejectForm-bdeeb909.js";import{C as De}from"./ClientLayout-b8fcf2a7.js";import{r as je,i as qe,a as Te}from"./jsx-runtime_commonjs-proxy-f691489f.js";import Me from"./CancelRequest-a641df34.js";import{c as M}from"./createSvgIcon-539e1997.js";import{T as W,a as K,b as U}from"./TableHead-f77037e2.js";import{T as _,a as o}from"./TableRow-dfec8f3e.js";import{I as v}from"./IconButton-9ba9fc36.js";import{D as Oe}from"./DeleteForm-7b246af1.js";import{E as Ee}from"./Edit-71d108b1.js";import{D as we}from"./Delete-0f3f6999.js";import{S as Fe}from"./Stack-33d46199.js";const H=M(e("path",{d:"M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2zm5 13.59L15.59 17 12 13.41 8.41 17 7 15.59 10.59 12 7 8.41 8.41 7 12 10.59 15.59 7 17 8.41 13.41 12 17 15.59z"}),"Cancel"),Y=M(e("path",{d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"}),"Close"),G=M(e("path",{d:"M9 16.2 4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4L9 16.2z"}),"Done");function ze({value:n}){const[l,s]=f.useState(null),c=h=>{s(h.currentTarget)},u=()=>{s(null)},p=!!l;return d(T,{children:[n&&e(A,{multiline:!0,defaultValue:n,inputProps:{readOnly:!0},sx:{maxHeight:"100%",overflowY:"auto",p:1,border:"none"},fullWidth:!0,"aria-owns":p?"mouse-over-popover":void 0,variant:"standard","aria-haspopup":"true",onMouseEnter:c,onMouseLeave:u}),e(be,{id:"mouse-over-popover",sx:{pointerEvents:"none",MaxWidth:"100px"},open:p,anchorEl:l,anchorOrigin:{vertical:"bottom",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"left"},onClose:u,disableRestoreFocus:!0,paperprops:{sx:{maxWidth:"px"}},children:e(A,{multiline:!0,defaultValue:n,inputProps:{readOnly:!0},sx:{maxHeight:"100%",p:1,pb:0,border:"none"},"aria-owns":p?"mouse-over-popover":void 0,variant:"standard",fullWidth:!0,"aria-haspopup":"true",onMouseEnter:c,onMouseLeave:u})})]})}const J=({data:n})=>n&&d(W,{children:[e(K,{children:d(_,{children:[e(o,{children:"نوع"}),e(o,{children:"تاریخ"}),e(o,{children:"تاریخ شروع"}),e(o,{children:"تاریخ پایان"})]})}),e(U,{children:d(_,{children:[e(o,{children:S.get(n.type)}),e(o,{children:ve(n.date??n.started_at)}),e(o,{children:C(n.date+" "+n.started_at)}),e(o,{children:C(n.date+" "+n.ended_at)})]})})]}),st=Object.freeze(Object.defineProperty({__proto__:null,default:J},Symbol.toStringTag,{value:"Module"}));var O={},Ne=qe;Object.defineProperty(O,"__esModule",{value:!0});var Q=O.default=void 0,ke=Ne(je()),$=Te,Ie=(0,ke.default)([(0,$.jsx)("path",{d:"M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"},"0"),(0,$.jsx)("path",{d:"M12.5 7H11v6l5.25 3.15.75-1.23-4.5-2.67z"},"1")],"AccessTime");Q=O.default=Ie;const V=new Map([["waiting",e(Q,{color:"warning"})],["rejected",e(H,{color:"error"})],["canceled",e(H,{color:"error"})],["accepted",e(G,{color:"success"})]]),E=n=>V.get(n),Le=({data:n})=>{const{setData:l,post:s,reset:c,data:u}=B(),[p,h]=f.useState(!1),R=r=>()=>{h(!0),l({id:r})},D=()=>{h(!1),c()},j=()=>{s(route("clientRequests.cancel",u.id),{onSuccess:D})};return n.length?d(T,{children:[d(W,{children:[e(K,{children:d(_,{children:[e(o,{children:"نوع"}),e(o,{children:"وضعیت"}),e(o,{children:"زمان درخواست"}),e(o,{children:"زمان آخرین تغیییرات"}),e(o,{children:"درخواست یا رد کننده"}),e(o,{children:"#"})]})}),e(U,{children:n.map(r=>{var i,y;return d(_,{children:[e(o,{children:S.get(r.type)}),e(o,{children:E(r.status)}),e(o,{children:C(r.created_at)}),e(o,{children:C(r.updated_at)}),e(o,{children:(i=r==null?void 0:r.revisable_by)==null?void 0:i.name}),e(o,{children:r.status==="waiting"&&new Date((y=r.requestable)==null?void 0:y.started_at_dateTime)>new Date&&e(v,{onClick:R(r.id),title:r.status,children:e(Y,{color:"error"})})})]},r.id)})})]}),e(Me,{onClose:D,open:p,onAccept:j})]}):null},lt=Object.freeze(Object.defineProperty({__proto__:null,default:Le,renderStatus:E,statuses:V},Symbol.toStringTag,{value:"Module"})),S=new Map([["shift","درخواست شیفت"],["changeUser","درخواست جابه جایی شیفت"],["takeLeave","درخواست مرخصی"],["daily","مرخصی روزانه"],["hourly","مرخصی ساعتی"]]),X=()=>{var L;const{post:n,setData:l,data:s,reset:c,processing:u}=B(),p=[{field:"name",headerName:"کاربر",type:"string",flex:1,sortable:!1,renderCell:({row:t})=>t.user.name},{field:"type",headerName:"نوع",type:"string",flex:.3,renderCell:({value:t})=>S.get(t)},{field:"created_at",headerName:"تاریخ درخواست",type:"date",flex:.3,renderCell:({value:t})=>C(t)},{field:"message",headerName:"توضیحات",type:"string",sortable:!1,flex:.5,renderCell:ze},{field:"status",headerName:"وضعیت",type:"string",flex:.2,sortable:!1,disableMenu:!0,align:"center",renderCell:({value:t})=>E(t)},{field:"revisable_by",headerName:"بررسی کننده",type:"string",flex:.5,renderCell:({row:t})=>{var a;return(a=t.revisable_by)==null?void 0:a.name}},{field:"comment",headerName:"توضیحات برزسی کننده",type:"string",flex:.5},{field:"updated_at",headerName:"تاریخ آخرین تغییر",type:"string",flex:.4,renderCell:({value:t})=>t?C(t):null},{field:"id",headerName:"#",type:"actions",sortable:!1,flex:.2,renderCell:t=>{var m,x,P;let a=[];return t.row.status==="waiting"&&new Date<new Date((x=(m=t==null?void 0:t.row)==null?void 0:m.requestable)==null?void 0:x.date)&&(j.user.id===t.row.user.id&&t.row.status==="waiting"&&(a.push(e(v,{title:"بروررسانی",onClick:oe(t.row),color:"warning",children:e(Ee,{})},"edit-"+t.value)),a.push(e(v,{title:"حذف",onClick:ae(t.row),color:"error",children:e(we,{})},"cancel-"+t.value))),((P=i==null?void 0:i.filters)==null?void 0:P.type)==="revised"&&a.push(d(Fe,{direction:"row",gap:1,children:[e(v,{onClick:pe(t.value),color:"error",title:"رد",children:e(Y,{})}),e(v,{onClick:ue(t.value),color:"success",title:"تایید",children:e(G,{})})]}))),a}}],{clientRequests:h,status:R,errors:D,auth:j,success:r,defaultValues:i}=me().props,[y,w]=f.useState(!1),[Z,q]=f.useState(!1),[ee,b]=f.useState(!1),[te,F]=f.useState(!1),[ne,z]=f.useState(!1),oe=t=>()=>{w(!0),re(t).finally(()=>{b(!0),w(!1)})},re=async t=>t?axios.get(route("clientRequestsApi.show",t)).then(a=>{l({...a.data.data,_method:"put"})}):null,N=()=>{c(),b(!1),q(!1)},ae=t=>()=>{l({...t,_method:"delete"}),q(!0)},se=(t,a,m,x)=>ge.Inertia.visit(route("client.clientRequests.index"),{only:["clientRequests","status","defaultValues"],data:{page:t,filters:a,sort:m,pageSize:x},preserveState:!0}),le=async()=>{n(route("client.clientRequests.destroy",s.id),{preserveState:!0,onSuccess:N})},ie=t=>{t.preventDefault(),n(s.id?route("client.clientRequests.update",s.id):route("client.clientRequests.store"),{onSuccess:N})},de=()=>{l({type:"takeLeave"}),b(!0)},g=()=>{c(),b(!1),F(!1),z(!1),c()},ce=()=>{q(!1),c()},k=t=>{l(h.data.find(a=>a.id===t))},ue=t=>()=>{k(t),F(!0)},pe=t=>()=>{k(t),z(!0)},he=()=>{n(route("client.clientRequests.confirm",s.id),{onSuccess:g})},fe=()=>{n(route("client.clientRequests.reject",s.id),{onSuccess:g})},I=(t,a)=>{l(m=>({...m,[t]:a}))};return d(T,{children:[e(Ce,{title:"لیست درخواست ها"}),e(ye,{defaultValues:i,success:r,status:R,reload:se,columns:p,data:h,rowHeight:100,addNew:((L=i==null?void 0:i.filters)==null?void 0:L.type)==="takeLeave",onClickAddNew:de,loading:u||y,Filter:xe,expandedKey:"requestable",ExpandedComponent:J}),e(_e,{clientRequest:s,open:ee,onClose:g,onSubmit:ie,onChange:I}),e(Se,{onConfirm:he,onClose:g,open:te,request:s}),e(Re,{onChange:I,onSubmit:fe,onClose:g,open:ne,request:s}),e(Oe,{title:"درخواست",openDelete:Z,disAgreeCB:ce,agreeCB:le})]})},Pe=[{title:"درخواست ها",link:null,icon:null}];X.layout=n=>e(De,{auth:n.props.auth,children:n,breadcrumbs:Pe});const it=Object.freeze(Object.defineProperty({__proto__:null,default:X,requestTypes:S},Symbol.toStringTag,{value:"Module"}));export{Y as C,G as D,ze as E,it as I,E as a,Le as b,st as c,lt as d,S as r};
