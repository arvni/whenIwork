import{a as e,r as f,j as c,F as T,u as W,b as he,H as fe,d as me}from"./app-9ac2a27d.js";import{a as Ce,c as C}from"./helper-9f361b88.js";import{T as ge}from"./TableLayout-02f79f3d.js";import{T as A}from"./TextField-e852a59f.js";import{P as ve}from"./Popover-306611ff.js";import be from"./Filter-8731077e.js";import xe from"./ClientRequest-93f965a6.js";import ye from"./ConfirmForm-30c3fc2a.js";import _e from"./RejectForm-fbcf7c64.js";import{C as Se}from"./ClientLayout-929fe8e6.js";import{r as Re,i as je,a as De}from"./jsx-runtime_commonjs-proxy-5611237a.js";import Te from"./CancelRequest-548c8ceb.js";import{c as q}from"./createSvgIcon-18282e1e.js";import{T as B,a as K,b as U}from"./TableHead-fe233058.js";import{T as _,a as o}from"./TableRow-cf08aae6.js";import{I as v}from"./IconButton-f2f79b09.js";import{E as qe}from"./Edit-ab5b1f45.js";import{D as Me}from"./Delete-a91fef9f.js";import{S as Oe}from"./Stack-ef7e8c0e.js";const H=q(e("path",{d:"M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2zm5 13.59L15.59 17 12 13.41 8.41 17 7 15.59 10.59 12 7 8.41 8.41 7 12 10.59 15.59 7 17 8.41 13.41 12 17 15.59z"}),"Cancel"),Y=q(e("path",{d:"M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"}),"Close"),G=q(e("path",{d:"M9 16.2 4.8 12l-1.4 1.4L9 19 21 7l-1.4-1.4L9 16.2z"}),"Done");function Ee({value:n}){const[i,s]=f.useState(null),d=h=>{s(h.currentTarget)},u=()=>{s(null)},p=!!i;return c(T,{children:[n&&e(A,{multiline:!0,defaultValue:n,inputProps:{readOnly:!0},sx:{maxHeight:"100%",overflowY:"auto",p:1,border:"none"},fullWidth:!0,"aria-owns":p?"mouse-over-popover":void 0,variant:"standard","aria-haspopup":"true",onMouseEnter:d,onMouseLeave:u}),e(ve,{id:"mouse-over-popover",sx:{pointerEvents:"none",MaxWidth:"100px"},open:p,anchorEl:i,anchorOrigin:{vertical:"bottom",horizontal:"left"},transformOrigin:{vertical:"top",horizontal:"left"},onClose:u,disableRestoreFocus:!0,paperprops:{sx:{maxWidth:"px"}},children:e(A,{multiline:!0,defaultValue:n,inputProps:{readOnly:!0},sx:{maxHeight:"100%",p:1,pb:0,border:"none"},"aria-owns":p?"mouse-over-popover":void 0,variant:"standard",fullWidth:!0,"aria-haspopup":"true",onMouseEnter:d,onMouseLeave:u})})]})}const J=({data:n})=>n&&c(B,{children:[e(K,{children:c(_,{children:[e(o,{children:"نوع"}),e(o,{children:"تاریخ"}),e(o,{children:"تاریخ شروع"}),e(o,{children:"تاریخ پایان"})]})}),e(U,{children:c(_,{children:[e(o,{children:S.get(n.type)}),e(o,{children:Ce(n.date??n.started_at)}),e(o,{children:C(n.date+" "+n.started_at)}),e(o,{children:C(n.date+" "+n.ended_at)})]})})]}),ot=Object.freeze(Object.defineProperty({__proto__:null,default:J},Symbol.toStringTag,{value:"Module"}));var M={},we=je;Object.defineProperty(M,"__esModule",{value:!0});var Q=M.default=void 0,Fe=we(Re()),$=De,ze=(0,Fe.default)([(0,$.jsx)("path",{d:"M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"},"0"),(0,$.jsx)("path",{d:"M12.5 7H11v6l5.25 3.15.75-1.23-4.5-2.67z"},"1")],"AccessTime");Q=M.default=ze;const X=new Map([["waiting",e(Q,{color:"warning"})],["rejected",e(H,{color:"error"})],["canceled",e(H,{color:"error"})],["accepted",e(G,{color:"success"})]]),O=n=>X.get(n),Ne=({data:n})=>{const{setData:i,post:s,reset:d,data:u}=W(),[p,h]=f.useState(!1),R=r=>()=>{h(!0),i({id:r})},j=()=>{h(!1),d()},D=()=>{s(route("clientRequests.cancel",u.id),{onSuccess:j})};return n.length?c(T,{children:[c(B,{children:[e(K,{children:c(_,{children:[e(o,{children:"نوع"}),e(o,{children:"وضعیت"}),e(o,{children:"زمان درخواست"}),e(o,{children:"زمان آخرین تغیییرات"}),e(o,{children:"درخواست یا رد کننده"}),e(o,{children:"#"})]})}),e(U,{children:n.map(r=>{var l,b;return c(_,{children:[e(o,{children:S.get(r.type)}),e(o,{children:O(r.status)}),e(o,{children:C(r.created_at)}),e(o,{children:C(r.updated_at)}),e(o,{children:(l=r==null?void 0:r.revisable_by)==null?void 0:l.name}),e(o,{children:r.status==="waiting"&&new Date((b=r.requestable)==null?void 0:b.started_at_dateTime)>new Date&&e(v,{onClick:R(r.id),title:r.status,children:e(Y,{color:"error"})})})]},r.id)})})]}),e(Te,{onClose:j,open:p,onAccept:D})]}):null},rt=Object.freeze(Object.defineProperty({__proto__:null,default:Ne,renderStatus:O,statuses:X},Symbol.toStringTag,{value:"Module"})),S=new Map([["shift","درخواست شیفت"],["changeUser","درخواست جابه جایی شیفت"],["takeLeave","درخواست مرخصی"],["daily","مرخصی روزانه"],["hourly","مرخصی ساعتی"]]),Z=()=>{var I;const{post:n,setData:i,data:s,reset:d,processing:u}=W(),p=[{field:"name",headerName:"کاربر",type:"string",flex:1,sortable:!1,renderCell:({row:t})=>t.user.name},{field:"type",headerName:"نوع",type:"string",flex:.3,renderCell:({value:t})=>S.get(t)},{field:"created_at",headerName:"تاریخ درخواست",type:"date",flex:.3,renderCell:({value:t})=>C(t)},{field:"message",headerName:"توضیحات",type:"string",sortable:!1,flex:.5,renderCell:Ee},{field:"status",headerName:"وضعیت",type:"string",flex:.2,sortable:!1,disableMenu:!0,align:"center",renderCell:({value:t})=>O(t)},{field:"revisable_by",headerName:"بررسی کننده",type:"string",flex:.5,renderCell:({row:t})=>{var a;return(a=t.revisable_by)==null?void 0:a.name}},{field:"comment",headerName:"توضیحات برزسی کننده",type:"string",flex:.5},{field:"updated_at",headerName:"تاریخ آخرین تغییر",type:"string",flex:.4,renderCell:({value:t})=>t?C(t):null},{field:"id",headerName:"#",type:"actions",sortable:!1,flex:.2,renderCell:t=>{var m,y,L,P;let a=[];return t.row.status==="waiting"&&new Date<new Date((y=(m=t==null?void 0:t.row)==null?void 0:m.requestable)==null?void 0:y.date)&&(D.user.id===t.row.user.id&&t.row.status==="waiting"&&(a.push(e(v,{title:"بروررسانی",onClick:ne(t.row),color:"warning",children:e(qe,{})},"edit-"+t.value)),a.push(e(v,{title:"حذف",onClick:ae(t.row),color:"error",children:e(Me,{})},"cancel-"+t.value))),console.log((L=l==null?void 0:l.filters)==null?void 0:L.type),((P=l==null?void 0:l.filters)==null?void 0:P.type)==="revised"&&a.push(c(Oe,{direction:"row",gap:1,children:[e(v,{onClick:de(t.value),color:"error",title:"رد",children:e(Y,{})}),e(v,{onClick:ce(t.value),color:"success",title:"تایید",children:e(G,{})})]}))),a}}],{clientRequests:h,status:R,errors:j,auth:D,success:r,defaultValues:l}=he().props,[b,E]=f.useState(!1),[Ie,w]=f.useState(!1),[V,x]=f.useState(!1),[ee,F]=f.useState(!1),[te,z]=f.useState(!1),ne=t=>()=>{E(!0),oe(t).finally(()=>{x(!0),E(!1)})},oe=async t=>t?axios.get(route("clientRequestsApi.show",t)).then(a=>{i({...a.data.data,_method:"put"})}):null,re=()=>{d(),x(!1),w(!1)},ae=t=>()=>{i({...t,_method:"delete"}),w(!0)},le=(t,a,m,y)=>me.Inertia.visit(route("client.clientRequests.index"),{only:["clientRequests","status","defaultValues"],data:{page:t,filters:a,sort:m,pageSize:y},preserveState:!0}),se=t=>{t.preventDefault(),n(s.id?route("client.clientRequests.update",s.id):route("client.clientRequests.store"),{onSuccess:re})},ie=()=>{i({type:"takeLeave"}),x(!0)},g=()=>{d(),x(!1),F(!1),z(!1),d()},N=t=>{i(h.data.find(a=>a.id===t))},ce=t=>()=>{N(t),F(!0)},de=t=>()=>{N(t),z(!0)},ue=()=>{n(route("client.clientRequests.confirm",s.id),{onSuccess:g})},pe=()=>{n(route("client.clientRequests.reject",s.id),{onSuccess:g})},k=(t,a)=>{i(m=>({...m,[t]:a}))};return c(T,{children:[e(fe,{title:"لیست درخواست ها"}),e(ge,{defaultValues:l,success:r,status:R,reload:le,columns:p,data:h,rowHeight:100,addNew:((I=l==null?void 0:l.filters)==null?void 0:I.type)==="takeLeave",onClickAddNew:ie,loading:u||b,Filter:be,expandedKey:"requestable",ExpandedComponent:J}),e(xe,{clientRequest:s,open:V,onClose:g,onSubmit:se,onChange:k}),e(ye,{onConfirm:ue,onClose:g,open:ee,request:s}),e(_e,{onChange:k,onSubmit:pe,onClose:g,open:te,request:s})]})},ke=[{title:"درخواست ها",link:null,icon:null}];Z.layout=n=>e(Se,{auth:n.props.auth,children:n,breadcrumbs:ke});const at=Object.freeze(Object.defineProperty({__proto__:null,default:Z,requestTypes:S},Symbol.toStringTag,{value:"Module"}));export{Y as C,G as D,Ee as E,at as I,O as a,Ne as b,ot as c,rt as d,S as r};
